@using F4ConversationCloud.Domain.Enum
@model F4ConversationCloud.ClientAdmin.Models.TemplateModel.TemplatesListViewModel;
@namespace F4ConversationCloud.Domain.Extension
@{
    ViewData["Title"] = "Template List";

}
<div class="content">
    <div class="container-fluid">
        <div class="card">
            <h3 class="sub-heading">Templates </h3>

            <div class="table-responsive">
                <table class="table user-table">
                    <thead>
                        <tr>
                            <th>Sr. No.</th>
                            <th>
                                Template Name
                                <div class="input-group">
                                    <input type="text" class="form-control srcIcon" placeholder="Search" name="TemplateName" value="@Model.TemplateName" />
                                    <span class="searchIcon"></span>
                                </div>
                            </th>
                            <th>
                                Category
                                <div class="input-group">
                                    <select asp-for="Category" asp-items="Model.CategoryList" class="form-select">
                                        <option value="">Select Category</option>
                                    </select>

                                </div>

                            </th>
                            <th>
                                Language
                                <select asp-for="templateLanguages" asp-items="Model.LanguageList" class="form-select">
                                    <option value="">Select Language</option>
                                </select>
                            </th>


                            <th>
                                Last Updated
                                <input type="date"
                                       id="datepicker2"
                                       name="ModifiedOn"
                                       class="form-control search-form-control"
                                       value="@(Model.ModifiedOn?.ToString("yyyy-MM-dd") ?? "")"
                                       max="@DateTime.Now.ToString("yyyy-MM-dd")" />
                            </th>


                                 <th>
                                    Status
                                <select asp-for="TemplateStatus" asp-items="Model.StatusList" class="form-select">
                                    <option value="">Select Status</option>
                                </select>
                                </th>

                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.Templates != null && Model.Templates.Any())
                        {
                           
                            foreach (var item in Model.Templates)
                            {
                                
                                <tr>
                                    <td>@item.SrNo</td>
                                    <td>@item.TemplateName</td>
                                    <td>@item.Category</td>
                                    <td>@item.LanguageCode</td>
                                    <td>@item.ModifiedOn.ToString("dd MMM yyyy hh:mm tt")</td>
                                    <td><span class="badge @(item.TemplateStatus == "Approved" ? "success" : item.TemplateStatus == "Rejected" ? "danger" : "warning")">@item.TemplateStatus</span></td>
                                    <td>
                                        <div class="action">
                                            <a href="javascript:void(0);"
                                               class="eye-blue view-template"
                                               data-template-id="@item.TemplateId"
                                               data-bs-toggle="modal"
                                               data-bs-target="#exampleModal"></a>
                                        </div>
                                    </td>
                                </tr>
                               
                            }
                        }
                        else
                        {
                            <tr><td colspan="7" class="text-center">No templates found.</td></tr>
                        }
                    </tbody>




                </table>
            </div>
            <partial name="_Pagination" model="new PaginationViewModel { PageNumber = Model.PageNumber, PageSize = Model.PageSize, TotalCount = Model.TotalCount }" />
        </div>

    </div>
</div>

<div class="modal fade template-modal" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content" id="templateModalContent">
           
        </div>
    </div>
</div>

@section Scripts {
    <script>
        

        $("[name='Category'], [name='TemplateStatus'],[name='templateLanguages'],[name='ModifiedOn']").on("change", function () {
            loadData();
        });

        function loadData(pageNumber = 1) {
                let templateName = $("[name='TemplateName']").val()?.trim() || '';
                let category = $("[name='Category']").val();
                  let templateLanguages = $("[name='templateLanguages']").val()?.trim() || '';
                let modifiedOn = $("[name='ModifiedOn']").val()?.trim() || '';
                let templateStatus = $("[name='TemplateStatus']").val();
    
            const url = '@Url.Action("List", "TemplateManagemet")' +
                `?TemplateName=${encodeURIComponent(templateName)}` +
                `&Category=${encodeURIComponent(category)}` +
                  `&templateLanguages=${encodeURIComponent(templateLanguages)}` +
                `&ModifiedOn=${encodeURIComponent(modifiedOn)}` +
                `&TemplateStatus=${encodeURIComponent(templateStatus)}` +
                `&PageNumber=${pageNumber}`;

            location.href = url;
        }

        $(".srcIcon").on("keypress", function (e) {
            if (e.which === 13) loadData();
        });

        $(document).on("click", ".page-link", function () {
            const pageNumber = $(this).data("page-number");
            if (pageNumber) loadData(pageNumber);
        });
               $(document).on('click', '.view-template', function () {

            var templateId = $(this).data('template-id');
            var url = '@Url.Action("TemplateDetailsById", "TemplateManagemet")?templateId=' + templateId;
            $.ajax({
                url: url,
                type: 'GET',
                success: function (result) {
                    $('#templateModalContent').html(result);  
                },
                error: function () {
                    alert('Failed to load template details.');
                }
            });
        });

    </script>
}