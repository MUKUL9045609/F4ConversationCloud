@model F4ConversationCloud.SuperAdmin.Models.TemplateViewModel
@{
    ViewData["Title"] = "Create Template";
        var m = Model;
}

<div class="content">
    <div class="main-content">
        <div class="container-fluid">
            <div class="d-flex justify-content-between headerWrap mb-3">
                <div class="d-flex align-items-center gap-2">
                    <h3 class="sub-heading mb-0">
                        <a href="client-details.html"><span class="back"></span> Create Template</a>
                    </h3>

                </div>

            </div>
            <div class="row">
                <form asp-action="Create" method="post" enctype="multipart/form-data">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <div class="col-md-8">
                        <div class="card padding">
                            <div class="d-flex justify-content-between mb-3">
                                <h3>Template name<sup> *</sup></h3>
                                <span class="question"></span>
                            </div>
                            <div class="template-question mb-3">
                                <label for="exampleInputEmail1" class="form-label">Give your message template a name.</label>
                                <input asp-for="TemplateName" type="text"
                                       class="form-control"
                                       id="exampleInputEmail1"
                                       placeholder="Template name"
                                       aria-describedby="emailHelp" />
                                <div id="emailHelp" class="form-text">
                                    Template names can only contain small letters, numbers and
                                    underscores.
                                </div>
                                <span asp-validation-for="TemplateName" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="card padding">
                            <div class="d-flex justify-content-between mb-3">
                                <h3>Category<sup> *</sup></h3>
                            </div>
                            <div class="template-question mb-3">
                                <label for="exampleInputEmail1" class="form-label">
                                    Choose what type of message template you want to
                                    create.
                                </label>
                                <div class="row">
                                    @if (Model.TemplateCategoryList is not null)
                                    {
                                        @foreach (var t in Model.TemplateCategoryList)
                                        {
                                            <div class="col-md-4">
                                                <div class="mb-3">
                                                    <div class="form-check radio-btn mb-2">
                                                        <input asp-for="TemplateCategory" class="form-check-input"
                                                               type="radio"
                                                               id="@t.Value"
                                                               value="@t.Value" />
                                                        <label class="form-check-label"
                                                               for="flexRadioDefault1">
                                                            @t.Text
                                                        </label>
                                                    </div>
                                                    <p>
                                                        Send promo offers, product offers and more to
                                                        increase awareness and engagement.
                                                    </p>
                                                </div>
                                            </div>
                                        }
                                    }
                                    <span asp-validation-for="TemplateCategory" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="show-hide">
                            <div class="card padding">
                                <div class="d-flex justify-content-between mb-3">
                                    <h3>Language<sup> *</sup></h3>
                                    <span class="question"></span>
                                </div>
                                <div class="template-question mb-3">
                                    <label for="exampleInputEmail1" class="form-label">
                                        Choose which languages your message template will be sent
                                        in.
                                    </label>
                                    <select asp-for="Language" asp-items="Model.LanguageList" class="form-select" aria-label="Default select example">
                                        <option value="" selected>select language</option>
                                    </select>
                                </div>
                                <span asp-validation-for="Language" class="text-danger"></span>
                            </div>
                            <div class="card padding">
                                <div class="d-flex justify-content-between mb-3">
                                    <h3>Types Of Variables<sup> *</sup></h3>
                                    <span class="question"></span>
                                </div>
                                <div class="template-question mb-3">
                                    <select asp-for="VariableType" asp-items="Model.VariableTypeList" class="form-select" aria-label="Default select example">
                                    </select>
                                </div>
                                <span asp-validation-for="VariableType" class="text-danger"></span>
                            </div>
                            <div class="card padding">
                                <div class="d-flex justify-content-between mb-3">
                                    <h3>Media Samples <span class="key">Optional</span></h3>
                                    <span class="question"></span>
                                </div>
                                <div class="template-question mb-3">
                                    <select asp-for="MediaType" asp-items="Model.MediaTypeList" id="mediaType" class="form-select" aria-label="Default select example">
                                        <option value="" selected>None</option>
                                    </select>
                                    <div class="drag-file-wrapper" id="attatchment" style="display: none;">
                                        <label class="drag-file">
                                            <input asp-for="File" type="file" class="form-control file-upload-input" id="UploadedFile" accept=".jpg,.jpeg,.png" />
                                            <input type="hidden" asp-for="FileName" />
                                            <input type="hidden" asp-for="FileUrl" />
                                            <input type="file" />
                                            <span class="drag-title">Drag and drop to upload or <a href="#">choose files on your device</a></span>
                                        </label>
                                        <div class="mt-2" id="existingFileLink">
                                            @if (!string.IsNullOrEmpty(Model.FileUrl))
                                            {
                                                <a href="@Url.Content(Model.FileUrl)" target="_blank">@Model.FileName</a>
                                            }
                                        </div>
                                    </div>
                                    <span asp-validation-for="File" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="card padding">
                                <div class="d-flex justify-content-between mb-3">
                                    <h3>Header <span class="key">Optional</span></h3>
                                    <span class="question"></span>
                                </div>
                                <div class="template-question mb-3">
                                    <label for="exampleInputEmail1" class="form-label">
                                        Add a 60 character title to your message. Only one variable
                                        is supported in the header.
                                    </label>
                                    <input asp-for="Header" type="text" class="form-control" maxlength="60">
                                    <div class="d-flex justify-content-end">
                                        <button class="add-variables" id="header-add-btn">Add Variables</button>
                                    </div>
                                </div>
                            </div>
                            <div class="card padding">
                                <div class="d-flex justify-content-between mb-3">
                                    <h3>Body<sup> *</sup></h3>
                                    <span class="question"></span>
                                </div>
                                <div class="template-question mb-3">
                                    <label for="exampleInputEmail1" class="form-label">
                                        Enter the text for your message in the language you have
                                        selected.
                                    </label>
                                    <div class="note d-flex align-items-center">
                                        <span class="exclamatory"></span>
                                        <p>
                                            The text limit in the body should be less than 550
                                            characters and emojis should be less than 10 to avoid
                                            any template rejection
                                        </p>
                                    </div>
                                    <input asp-for="MessageBody" id="content" contenteditable="true" spellcheck="false" maxlength="550" />
                                    @* <div id="content" contenteditable="true" spellcheck="false">
                                        Lorem, ipsum.
                                    </div> *@
                                    <div class="toolbar">
                                        <button class="add-variables">Add Variables</button>
                                        <div class="btn-toolbar">
                                            <button onclick="formatDoc('bold')"><i class='bx bx-bold'></i></button>
                                            <button onclick="formatDoc('underline')"><i class='bx bx-underline'></i></button>
                                            <button onclick="formatDoc('italic')"><i class='bx bx-italic'></i></button>
                                            <button onclick="formatDoc('strikeThrough')"><i class='bx bx-strikethrough'></i></button>
                                            <button onclick="formatDoc('insertOrderedList')"><i class='bx bx-list-ol'></i></button>
                                            <button onclick="formatDoc('insertUnorderedList')"><i class='bx bx-list-ul'></i></button>
                                        </div>
                                    </div>
                                    <span asp-validation-for="MessageBody" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="card padding">
                                <h6>Variable samples</h6>
                                <p>Include samples of all variables in your message to help Meta review your template. Remember not to include any customer information to protect your customer's privacy.</p>

                                <ul class="add-veriables">
                                    <li>
                                        <small class="fw-medium">Header</small>
                                        <div class="d-flex gap-3">
                                            <div>
                                                <input type="text" class="form-control" value="{{1}}" readonly>
                                            </div>
                                            <div class="flex-grow-1">
                                                <input type="text" class="form-control">
                                            </div>
                                        </div>
                                    </li>
                                </ul>

                                <ul class="add-veriables">
                                    <li>
                                        <small class="fw-medium">Body</small>
                                        <div class="d-flex gap-3">
                                            <div>
                                                <input type="text" class="form-control" value="{{1}}" readonly>
                                            </div>
                                            <div class="flex-grow-1">
                                                <input type="text" class="form-control">
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>

                            <div class="card padding">
                                <div class="d-flex justify-content-between mb-3">
                                    <h3>Footer <span class="key">Optional</span></h3>
                                    <span class="question"></span>
                                </div>
                                <div class="template-question mb-3">
                                    <label for="exampleInputEmail1" class="form-label">Add a 60 character footer to your message. Variables are not supported in the footer.</label>
                                    <input asp-for="Footer" class="form-control" maxlength="60"/>
                                </div>
                                <span asp-validation-for="Footer" class="text-danger"></span>
                            </div>
                            <div class="card padding">
                                <div class="d-flex justify-content-between mb-3">
                                    <h3>Button <span class="key">Optional</span></h3>
                                    <span class="question"></span>
                                </div>
                                <div class="template-question mb-3">
                                    <label for="exampleInputEmail1" class="form-label">Please choose buttons to be added to the template. You can choose upto 10 buttons</label>
                                    <div class="dropdown add-btn-template">
                                        <button class="btn dropdown-toggle secondary-btn add-btn d-flex" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                                            Add button
                                        </button>
                                        <ul class="dropdown-menu" id="template-btn" aria-labelledby="dropdownMenuButton1">
                                            <li><a class="dropdown-item" href="#" id="custom"><span class=""></span> Custom</a></li>
                                            <li><a class="dropdown-item" href="#" id="visit-website">Visit Website</a></li>
                                        </ul>

                                    </div>
                                    <ul class="add-template-button-list">
                                        <li>
                                            <div class="d-flex align-items-center form-wrapper gap-3">

                                                <div>
                                                    <label>Type</label>
                                                    <input class="form-control" value="Custom" />
                                                </div>
                                                <div>
                                                    <label>Button Text</label>
                                                    <input class="form-control" value="Quick Reply" />
                                                </div>
                                            </div>
                                            <div class="drag-close">

                                                <button class="close"></button>
                                            </div>
                                        </li>

                                        <li>
                                            <div class="d-flex align-items-center form-wrapper gap-3">

                                                <div>
                                                    <label>Type</label>
                                                    <input class="form-control" value="Visit Website" />
                                                </div>
                                                <div>
                                                    <label>Button Text</label>
                                                    <input class="form-control" value="Visit Website" />
                                                </div>
                                            </div>
                                            <div class="drag-close">

                                                <button class="close"></button>
                                            </div>
                                        </li>
                                    </ul>
                                </div>

                            </div>
                        </div>

                        <div class="d-flex gap-2 mb-3">
                            <button class="btn danger-btn" type="button">Clear All</button>
                            <button class="btn primary-btn" type="submit">Submit</button>
                        </div>
                    </div>
                </form>
                <div class="col-md-4">
                    <div class="template-preview">
                        <h4>Preview</h4>
                        <div class="template-white-card">
                            @* <span><img src="images/card-img-03.webp"></span> *@
                            <div class="description">
                                <p>Dear {{1}}</p>
                                <p>We are excited to present you with an exclusive offer ! {{}}</p>
                            </div>
                            <div class="time">1:59 PM</div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-ajax-unobtrusive/jquery.unobtrusive-ajax.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/dist/jquery.validate.unobtrusive.min.js"></script>
    <partial name="_ValidationScriptsPartial" />
    <script>
        $(document).ready(function(){
            $("input[name=flexRadioDefault]").change(function() {
                var test = $(this).val();
                $(".show-hide").hide();
                $("#"+test).show();
            });

            $('.drag-file-wrapper').hide();

            $('#mediaType').change(function () {
                var selectedValue = parseInt($(this).val());
                var selectedText = $('[name="MediaType"] option:selected').text();
                var $fileInput = $('#UploadedFile');
                var $attachment = $('#attatchment');
                var $existingFileLink = $('#existingFileLink');
                var $fileValidationMessage = $('[data-valmsg-for="File"]');

                $fileInput.val('');
                $existingFileLink.html('');
                $fileInput.removeAttr('accept');

                var hasValidationError = $fileValidationMessage.text().trim().length > 0;
                
                if (selectedValue > 0 && selectedText != 'Location') {
                    $attachment.show();

                    switch (selectedText) {
                        case 'Image':
                            $fileInput.attr('accept', '.jpg,.jpeg,.png');
                            break;
                        case 'Video':
                            $fileInput.attr('accept', '.mp4,.avi,.mov,.wmv');
                            break;
                        case 'Document':
                            $fileInput.attr('accept', '.pdf,.doc,.docx,.xls,.xlsx');
                            break;
                    }
                }else if (!hasValidationError) {
                    $attachment.hide();
                }

                if (selectedValue > 0){
                    $("#header-add-btn").attr("disabled", true);
                    $('#Header').attr('readonly', true);
                }
                else{
                    $("#header-add-btn").removeAttr("disabled");
                    $('#Header').removeAttr('readonly');
                }
            });

            $('#mediaType').trigger('change');

            $("#custom-wrap").hide();

            $("#custom").change(function(){
                $("#custom-wrap").show();
            });
        });

        document.getElementById('UploadedFile').addEventListener('change', function () {
            commonHelper.handleFileUpload('UploadedFile', 'existingFileLink', 'File', 'FileName');
        });
    </script>
}